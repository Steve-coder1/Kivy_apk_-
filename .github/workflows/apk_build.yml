name: Build Kivy APK using Docker

on:
  push:
    branches:
      - main

jobs:
  build-apk:
    runs-on: ubuntu-latest
    timeout-minutes: 60

    steps:
    - name: Checkout repo
      uses: actions/checkout@v3

    - name: Build APK with Kivy Buildozer Docker
      uses: addnab/docker-run-action@v3
      with:
        image: kivy/buildozer:latest
        options: -v ${{ github.workspace }}:/home/buildozer/project
        run: |
          cd /home/buildozer/project
          buildozer init
          sed -i 's/title = My Application/title = HelloKivy/' buildozer.spec
          sed -i 's/package.name = myapp/package.name = hellokivy/' buildozer.spec
          sed -i 's/package.domain = org.test/package.domain = org.example/' buildozer.spec
          echo "source.include_exts = py,kv,png,jpg,atlas" >> buildozer.spec
          buildozer -v android debug

    - name: Upload APK artifact
      uses: actions/upload-artifact@v4
      with:
        name: HelloKivy-apk
        path: bin/*.apk
